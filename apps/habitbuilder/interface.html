<html>
  <head>
    <link rel="stylesheet" href="../../css/spectre.min.css">
  </head>
  <body>
    <h2>Settings</h2>
    <div id="settings"></div>
    <button class="btn btn-default" id="btnSave">Save</button>

    <script src="../../core/lib/interface.js"></script>
    <script src="settings-form.js"></script>
    <script>

const FILENAME = "habitbuilder.settings.json";
const settingsElement = document.getElementById("settings");

function disableFormInput() {
  document.querySelectorAll(".form-input").forEach(el => el.disabled = true);
  document.querySelectorAll(".btn").forEach(el => el.disabled = true);
}

function getData() {
  // show loading window
  Util.showModal("Loading...");
  Util.readStorage(FILENAME, data=>{
    const settings = JSON.parse(data || "[]");

    // remove window
    Util.hideModal();

    // build settings form
    settingsHtml = buildSettingsForm(settings.questions, settings.reminderTime);
    settingsElement.innerHTML = settingsHtml;

    document.getElementById("btnSave").addEventListener("click", function() {
      // Get questions
      const settings = getSettingsFromForm();
      disableFormInput();
      Util.writeStorage(FILENAME, JSON.stringify(settings), () => {
        location.reload(); // reload so we see current data
      });
    });
  });
}

// Called when app starts
function onInit() {
  getData();
}
    </script>
  </body>
</html>
