<html>
  <head>
    <link rel="stylesheet" href="../../css/spectre.min.css">
  </head>
  <body>
    <button id="download-csv" class="btn btn-default">Download CSV</button>
    <button id="clear-csv" class="btn btn-danger">Clear CSV</button>
    <h2>Settings</h2>
    <div id="settings"></div>
    <button class="btn btn-primary" id="btnSave">Save</button>

    <script src="../../core/lib/interface.js"></script>
    <script src="settings-form.js"></script>
    <script src="csv.js"></script>
    <script>


const SETTINGS_FILE = "habitbuilder.settings.json";

const settingsElement = document.getElementById("settings");

function disableFormInput() {
  document.querySelectorAll(".form-input").forEach(el => el.disabled = true);
  document.querySelectorAll(".btn").forEach(el => el.disabled = true);
}

function getSettings() {
  // show loading window
  Util.showModal("Loading...");
  Util.readStorage(SETTINGS_FILE, data=>{
    const settings = JSON.parse(data || "[]");

    // remove window
    Util.hideModal();

    // build settings form
    settingsHtml = buildSettingsForm(settings.questions, settings.reminderTime);
    settingsElement.innerHTML = settingsHtml;

    document.getElementById("btnSave").addEventListener("click", function() {
      // Get questions
      const settings = getSettingsFromForm();
      if (!settings) {
        return;
      }
      disableFormInput();
      Util.writeStorage(FILENAME, JSON.stringify(settings), () => {
        location.reload(); // reload so we see current data
      });
    });
  });
}

let csvData = '';

function getData() {
  Util.readStorage('habitbuilder.data.csv', data => {
    csvData = data.trim();
  });
}

// Called when app starts
function onInit() {
  getData();
  getSettings();
}
    </script>
  </body>
</html>
